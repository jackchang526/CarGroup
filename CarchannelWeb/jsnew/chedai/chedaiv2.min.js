var carloan=function(a){this.options={loading:!1,year:0,referprice:0,csid:0,carid:0,payrate:.3,loanmonths:36,page:1,pagelength:20,stateid:2,cityid:201,provdropdownlist:"#prov-list",citydropdownlist:"#city-list",orderfield:"MonthlyPayment",agentid:0},this.options.api_get_package_list="http://mai.bitauto.com/InsuranceAndLoan/Api/Loan/GetPackages/?downPaymentRate={4}&repaymentPeriod={5}&carModelId={2}&cityId={6}&orderBy={7}&pageNum={8}",this.options.api_get_unique_package="http://mai.bitauto.com/InsuranceAndLoan/Api/Loan/GetUniquePackagesByCompanyAndAppointFirst/?downPaymentRate={4}&repaymentPeriod={5}&carModelId={2}&cityId={6}&orderBy={7}&pageNum={8}&packageId={3}",this.options.api_get_package="http://mai.bitauto.com/InsuranceAndLoan/Api/Loan/GetPackageWithApplicationCount/?packageId={3}&downPaymentRate={4}&carModelId={2}&cityId={6}",this.options.api_submit_apply="http://mai.bitauto.com/InsuranceAndLoan/Api/Loan/SubmitApplication/?callback=?",this.options.api_get_province_list="http://mai.bitauto.com/InsuranceAndLoan/Region/GetProvinces",this.options.api_get_city_list="http://mai.bitauto.com/InsuranceAndLoan/Region/GetCities?provinceid={0}",this.options.api_check_mobile="http://mai.bitauto.com/InsuranceAndLoan/Api/Loan/UserHasApplied/?callback=?",this.options.api_get_apply_count="http://mai.bitauto.com/InsuranceAndLoan/Api/Loan/GetApplicationCountForSerialBrand?serialBrandId={0}&callback=?",this.options.apply_success_url=!1,this.options.applyposturl="/{1}/chedai/sq/m{2}/?pakid={3}&payrate={4}&cityid={6}&months={5}",this.options.loandetailurl="/{1}/chedai/xq/m{2}/?pakid={3}&payrate={4}&cityid={6}&months={5}",this.options.single_select=!1,this.options.carlist_init_callback=!1,this.options.provinces_init_callback=!1,this.options.cities_init_callback=!1,this.options.before_load_callback=!1,this.options.after_load_callback=!1,this.options.get_package_callback=!1,this.options.on_city_change=!1,this.options.municipals={s2:{name:"北京",cityid:201},s26:{name:"天津",cityid:2601},s31:{name:"重庆",cityid:3101},s24:{name:"上海",cityid:2401}},this.options=$.extend(this.options,a),this.data={},this.submiting=!1};carloan.features={f101:{"class":"fc",title:"本地房产"},f102:{"class":"fk",title:"2日放款"},f103:{"class":"sxbj",title:"手续便捷"},f1:{"class":"dll",title:"低利率"},f2:{"class":"cdll",title:"超低利率"},f3:{"class":"wll",title:"零利率"},f4:{"class":"lcsf",title:"两成首付"},f5:{"class":"zcwn",title:"最长五年"},f6:{"class":"txwk",title:"弹性尾款"},f7:{"class":"wyg",title:"无月供"},f8:{"class":"dyg",title:"低月供"},f9:{"class":"jssp",title:"机速审批"},f10:{"class":"zljb",title:"资料简便"},f11:{"class":"mdy",title:"免抵押"},f12:{"class":"mjf",title:"免家访"},f13:{"class":"lpzs",title:"礼品赠送"},f14:{"class":"tshd",title:"特殊活动"},f15:{"class":"xscx",title:"限时促销"},f16:{"class":"cxzx",title:"车型专享"},f17:{"class":"zzfw",title:"增值服务"}},carloan.errors={error1:{code:1,message:"未选择套餐"},error2:{code:2,message:"您已申请过该车型，请查看其他车型"},error4:{code:4,message:"保存失败"}},carloan.common={format:function(a){var d,b=arguments,c=new Array;for(d=1;d<b.length;d++)c.push(b[d]);return a.replace(/\{(\d+)\}/g,function(a,b){return c[b]})},isnumber:function(){return!isNaN(this)},formatMonths:function(a){var d,b="",c=Math.floor(a/12);switch(c>0&&(b=c+"年"),d=a%12){case 6:b+="半";break;case 0:break;default:b+=d+"个月"}return b}},window.json_callback_for_prov=function(){},window.json_callback_for_city=function(){},window.json_callback_for_load=function(){},window.json_callback_for_getpak=function(){},carloan.prototype.getcities=function(a){var b=this,c=b.options;$.ajax({url:carloan.common.format(c.api_get_city_list,c.stateid),cache:!0,dataType:"jsonp",jsonpCallback:"json_callback_for_city",success:function(d){var f,g,h,e=$(c.citydropdownlist);if(e.length){for(f=[],f.push('<option value="0">请选择</option>'),g=0;g<d.length;g++)h=d[g],f.push(carloan.common.format('<option value="{0}">{1}</option>',h.ID,h.Name));e.html(f.join("")),e.change(function(){c.cityid=e.val(),c.on_city_change(b,c.cityid,this),"apply"==c.pagetype?b.loadunique():b.load()}),c.cityid>0&&e.val(c.cityid)}c.cities_init_callback&&b.options.cities_init_callback(b,d,a)},error:function(){},complete:function(){}})},carloan.prototype.init=function(){var a=this,b=a.options;"undefined"!=typeof bit_locationInfo&&bit_locationInfo.cityId&&(b.cityid=bit_locationInfo.cityId,b.stateid=Math.floor(b.cityid/100)),"undefined"!=typeof BitA&&BitA.DropDownList&&typeof BitA.DropDownList({container:{cartype:"cars"},include:{cartype:"1"},parent:{cartype:b.csid},dvalue:{cartype:b.carid},callback:{cartype:function(c){a.data.carlist=c,a.options.carlist_init_callback&&a.options.carlist_init_callback(a,c),"apply"==b.pagetype?a.loadunique():a.load()}}}),$.ajax({url:b.api_get_province_list,cache:!0,dataType:"jsonp",jsonpCallback:"json_callback_for_prov",success:function(c){var f,g,d=$(b.provdropdownlist),e=[];if(d.length){for(e.push('<option value="0">请选择</option>'),f=0;f<c.length;f++)g=c[f],e.push(carloan.common.format('<option value="{0}">{1}</option>',g.ID,g.Name));d.html(e.join("")),b.stateid>0&&d.val(b.stateid),d.change(function(){b.stateid=d.val(),a.getcities()}),d.change()}b.provinces_init_callback&&a.options.provinces_init_callback(a,c)},error:function(){},complete:function(){}})},carloan.log=function(a){"undefined"!=typeof console&&console.log&&console.log(a)},carloan.prototype.load=function(a){var b=this,c=b.options;this.loadinternal($.extend(a,{dataapi:c.api_get_package_list}))},carloan.prototype.loadunique=function(a){var b=this,c=b.options;this.loadinternal($.extend(a,{dataapi:c.api_get_unique_package}))},carloan.prototype.loadinternal=function(a){var e,b=this,c=b.options,d=c.api_get_unique_package;return a&&(c.page=a.page&&a.page?a.page:1,d=a.dataapi&&a.dataapi.length?a.dataapi:c.api_get_unique_package),c.before_load_callback&&c.before_load_callback(b),e=carloan.common.format(d,c.csid,c.csspell,c.carid,c.agentid,c.payrate,c.loanmonths,c.cityid,c.orderfield,c.page),c.carid>0&&c.loanmonths>0&&c.payrate>0&&c.cityid>0?(carloan.log(e),$.ajax({url:e,dataType:"jsonp",cache:!0,jsonpCallback:"json_callback_for_load",success:function(a){c.after_load_callback&&c.after_load_callback(b,a)},error:function(a,d,e){c.load_failed_callback&&c.load_failed_callback(b,a,d,e)},complete:function(a,d){c.load_complete_callback&&c.load_complete_callback(b,a,d)}}),void 0):(c.after_load_callback&&c.after_load_callback(b,null),void 0)},carloan.prototype.getpackage=function(){var a=this,b=a.options,c=carloan.common.format(b.api_get_package,b.csid,b.csspell,b.carid,b.agentid,b.payrate,b.loanmonths,b.cityid);carloan.log(c),$.ajax({type:"get",cache:!0,url:c,dataType:"jsonp",jsonpCallback:"json_callback_for_getpak",success:function(a){b.get_package_callback&&b.get_package_callback(a)},error:function(){},complete:function(){}})},carloan.prototype.checkmobile=function(a,b){var c=this;$.ajax({url:c.options.api_check_mobile,data:a,dataType:"jsonp",success:function(a){b(c,a)},error:function(){alert("暂时无法提交申请，请稍候再试！")},complete:function(){}})},carloan.prototype.submitapply=function(a,b){var e,c=this,d=c.options;1==c.submiting&&alert("请等待上一次提交申请结束"),c.submiting=!0,$("body").css({cursor:"wait"}),e=$.extend({CityId:d.cityid,CarModelId:d.carid,Age:0,Ref:d.ref?d.ref:""},a||{}),$.ajax({url:d.api_submit_apply,data:e,dataType:"jsonp",success:function(a,c,d){b&&b.success&&b.success(a,c,d)},error:function(a,d,e){b&&b.error&&b.error(a,d,e),c.submiting=!1},complete:function(a,d){b&&b.complete&&b.complete(a,d),$("body").css({cursor:"default"}),c.submiting=!1}})},carloan.prototype.getapplycount=function(a){var b=this;$.ajax({url:carloan.common.format(b.options.api_get_apply_count,b.options.csid),dataType:"jsonp",success:function(b){a&&a(b)},error:function(){},complete:function(){}})},jQuery.fn.pagination=function(a,b){return b=jQuery.extend({items_per_page:10,num_display_entries:10,current_page:0,num_edge_entries:0,link_to:"#",prev_text:"Prev",next_text:"Next",ellipse_text:"...",prev_show_always:!0,next_show_always:!0,prev_enabled_css:!1,prev_disabled_css:!1,next_enabled_css:!1,next_disabled_css:!1,enabled_css:!1,callback:function(){return!1},callback_after_init:!0},b||{}),this.each(function(){function c(){return Math.ceil(a/b.items_per_page)}function d(){var a=Math.ceil(b.num_display_entries/2),d=c(),e=d-b.num_display_entries,f=g>a?Math.max(Math.min(g-a,e),0):0,h=g>a?Math.min(g+a,d):Math.min(b.num_display_entries,d);return[f,h]}function e(a,c){g=a,f();var d=b.callback(a,h);return d||(c.stopPropagation?c.stopPropagation():c.cancelBubble=!0),d}function f(){var a,f,i,j,k,l,m;if(h.empty(),a=d(),f=c(),i=function(a){return function(b){return e(a,b)}},j=function(a,c){var d;a=0>a?0:f>a?a:f-1,c=jQuery.extend({text:a+1,classes:""},c||{}),a==g?(d=jQuery("<span class='current'>"+c.text+"</span>"),c.prev_disabled_css&&d.addClass(c.prev_disabled_css)):d=jQuery("<a>"+c.text+"</a>").bind("click",i(a)).attr("href",b.link_to.replace(/__id__/,a)),c.classes&&d.addClass(c.classes),h.append(d)},b.prev_text&&(g>0||b.prev_show_always)&&j(g-1,{text:b.prev_text,classes:" "+b.prev_disabled_css}),a[0]>0&&b.num_edge_entries>0){for(k=Math.min(b.num_edge_entries,a[0]),l=0;k>l;l++)j(l);b.num_edge_entries<a[0]&&b.ellipse_text&&jQuery("<span>"+b.ellipse_text+"</span>").appendTo(h)}for(l=a[0];l<a[1];l++)j(l);if(a[1]<f&&b.num_edge_entries>0)for(f-b.num_edge_entries>a[1]&&b.ellipse_text&&jQuery("<span>"+b.ellipse_text+"</span>").appendTo(h),m=Math.max(f-b.num_edge_entries,a[1]),l=m;f>l;l++)j(l);b.next_text&&(f-1>g||b.next_show_always)&&j(g+1,{text:b.next_text,classes:" "+b.next_disabled_css})}var h,g=b.current_page;a=!a||0>a?1:a,b.items_per_page=!b.items_per_page||b.items_per_page<0?1:b.items_per_page,h=jQuery(this),this.selectPage=function(a){e(a)},this.prevPage=function(){return g>0?(e(g-1),!0):!1},this.nextPage=function(){return g<c()-1?(e(g+1),!0):!1},f(),b.callback_after_init&&b.callback(g,this)})},$(function(){function l(){var j,l,m,n,a=$(".xiala_box"),b=a.find(".relation_tab_new"),f=$("ul.taochan"),g=$(".tc_loging"),h=$(".no_mess").clone(!0);$(".fanye_box"),"undefined"!=typeof bit_locationInfo&&bit_locationInfo.cityId&&(k.cityid=bit_locationInfo.cityId,k.stateid=Math.floor(k.cityid/100)),k.carlist_init_callback=function(a,b){var c,d,e,f,h,i;g.show(),c={},d=0;for(e in b)f=b[e],f.referprice>0&&(c[f.goid]||(c[f.goid]=[]),f.pv=k.pvdata&&k.pvdata[e]?k.pvdata[e]:0,d=f.pv>d?f.pv:d,c[f.goid].push(f));h=[];for(e in c){for(h.push("<h5>"+e+"</h5>"),h.push('<ul year="'+e+'">'),i=0;i<c[e].length;i++)f=c[e][i],h.push('<li carid="'+f.id+'" title="'+e+" "+(k.csname?k.csname+" ":"")+f.name+'"><div class="w1"><a href="#">'+f.name+'</a></div><div class="wbox"><p class="bfb" style="width:'+(d>0?1*f.pv/d:0)+'%"></p></div><div class="bs">手动</div><div class="jg">'+f.referprice+"万</div></li>");h.push("</ul>")}},k.after_load_callback=function(a,b){var c,d,e,g,i,j,k,l,o,p,q,r,s,t,u;if(f.find("li:gt(0)").remove(),c=b&&b.Total>0,$(".map_link em").text(c?b.Total:"0"),!c&&!c)return h.show().appendTo(f),$(".fanye_box").hide(),void 0;for(d=[],e=carloan.features,g=b.Packages,i=a.options,d.push(f.html()),j={},k=0;k<b.Companies.length;k++)j[b.Companies[k].Id]=b.Companies[k];for(k=0;k<g.length;k++){for(l=g[k],l.PromotionTitle&&l.PromotionTitle.length?'<span class="tuijian">推荐</span>':"",o="",p="",q=0;l.Features&&3>q&&q<l.Features.length;q++)r=l.Features[q],e["f"+r.Id]&&(p+='<a class="'+e["f"+r.Id]["class"]+'" href="#">'+r.Name+'<div class="box300" style="display:none;"><span class="sm_txtbox"><em class="jt"></em>'+r.Description+"</span></div></a>");s=carloan.common.format(i.applyposturl,i.csid,i.csspell,i.carid,l.Id,100*i.payrate,i.loanmonths,i.cityid),t=carloan.common.format(i.loandetailurl,i.csid,i.csspell,i.carid,l.Id,100*i.payrate,i.loanmonths,i.cityid),u=carloan.common.format('<li url="'+t+'"><div class="jg"><p class="tit"><a href="'+t+'" target="_blank">{6}</a>{8}</p><p class="cont"><a href="'+t+'" target="_blank">{1}</a></p>{9}</div>'+'<div class="zlx">{3}</div>'+'<div class="yugong"><span class="red">{4}元</span><a class="sm" href="#">说明<p class="sm_txtbox" style="display:none;"><em class="jt"></em>月利率 {7}%</p></a></div>'+'<div class="tedian" style="height:60px;">{10}</div>'+'<div class="shenqin"><a target="_blank" href="'+s+"&ref=sq2"+'" class="select_b">免费申请</a></div>'+'<div class="clear"></div>'+"</li>",l.Id,l.Name,l.PromotionTitle,0==l.TotalInterest?"0元":(1*l.TotalInterest/1e4).toFixed(2)+"万元",l.MonthlyPayment.toFixed(0),l.CompanyId,j[l.CompanyId]?j[l.CompanyId].Name:"",(l.InterestRate/.12).toFixed(2),"",o,p),d.push(u)}f.html(d.join("")),f.find("li:gt(0)").mouseenter(function(){curPakage&&curPakage.removeClass("current"),curPakage=$(this).addClass("current")}).mouseleave(function(){curPakage=curPakage.removeClass("current")}),$(".tedian>a").click(function(a){a.preventDefault()}).mouseenter(function(){$(this).find(".box300").show()}).mouseleave(function(){$(this).find(".box300").hide()}),$(".yugong .sm").click(function(a){a.preventDefault()}).mouseenter(function(){$(this).find(".sm_txtbox").show()}).mouseleave(function(){$(this).find(".sm_txtbox").hide()}),b.Total<=i.pagelength||($(".fanye_box").show(),$("#div-pager").pagination(b.Total,{current_page:i.page-1,items_per_page:i.pagelength,prev_text:"上一页",next_text:"下一页",prev_disabled_css:"nolink",next_disabled_css:"nolink",callback_after_init:!1,callback:function(a){return n.load({page:a+1}),!1}}))},k.before_load_callback=function(a){var b,c;f.find("li:gt(0)").remove(),g.show(),b=a.options,$("#price-total").text(b.referprice+"万"),$("#price-firstpay").text((b.referprice*b.payrate).toFixed(2)+"万"),$("#loan-money").text((b.referprice*(1-b.payrate)).toFixed(2)+"万"),$("#loan-time").text($("#filter-months a.curr").text()),c=carloan.common.format(b.applyposturl,b.csid,b.csspell,b.carid,0,100*b.payrate,b.loanmonths,b.cityid),$("#quckapply").attr("href",c+"&ref=sq1")},k.load_complete_callback=function(){g.hide()},a.mouseenter(function(c){c.stopPropagation(),a.find(".xiala").addClass("current"),b.show()}).mouseleave(function(c){c.stopPropagation(),a.find(".xiala").removeClass("current"),b.hide()}),$(document).bind("click",function(c){c.stopPropagation(),c.target!=a[0]&&0===a.has(c.target).length&&(a.find(".xiala").removeClass("current"),b.hide())}),a.find(".xiala").click(function(){var a="none"==b.css("display");a?b.show():b.hide()}),j=!1,b.find("tr").mouseenter(function(){j=$(this).css("background-color","rgb(235, 235, 235)")}).mouseleave(function(){j&&j.css("background-color","")}).click(function(c){c.stopPropagation(),c.preventDefault();var d=$(this);l&&l.removeClass("current"),l=d.addClass("current"),a.find(".xiala").text(d.attr("carname")).removeClass("current"),b.hide(),n.options.carid=d.attr("carid"),n.options.referprice=d.attr("price"),n.load()}),l=b.find('tr[carid="'+k.carid+'"]'),0!=k.carid&&l.length||(l=b.find("tr:first")),l.length&&(l.addClass("current"),a.find(".xiala").text(l.attr("carname")),k.carid=l.attr("carid"),k.referprice=l.attr("price")),$("#filter-rate a").click(function(a){a.preventDefault(),c&&c.removeClass("curr"),c=$(this).addClass("curr"),n.options.payrate=parseFloat($(this).attr("val")),n.load()}),$("#filter-months a").click(function(a){a.preventDefault(),d&&d.removeClass("curr"),d=$(this).addClass("curr"),n.options.loanmonths=parseFloat(d.attr("val")),n.load()}),$("#suitlist .h3_tab li").click(function(a){a.preventDefault(),e&&e.removeClass("current"),e=$(this).addClass("current"),n.options.orderfield=$(this).attr("fieldname"),n.load()}),e=$("#suitlist .h3_tab li:first"),k.payrate>0&&(m=$('#filter-rate a[val="'+k.payrate+'"]'),c&&c.removeClass("curr"),m.length&&(c=m.addClass("curr"))),k.loanmonths>0&&(m=$('#filter-months a[val="'+k.loanmonths+'"]'),d&&d.removeClass("curr"),m.length&&(d=m.addClass("curr"))),n=new carloan(k),n.init(),n.getapplycount(function(a){"0"==a?$("#apply_count").hide():($("#apply_count").hide(),$("#apply_count").show().find("span").text(a))})}function m(){var a,b;k.get_package_callback=function(a){if(a.Package){var b=a.Package;$("#monthpay").text(b.MonthlyPayment.toFixed(0)+"元"),b.TotalInterest>0?$("#totalpay").text((b.TotalInterest/1e4).toFixed(2)+"万"):$("#totalpay").text("无"),b.FinalPayment>0?$("#final_pay").text((b.FinalPayment/1e4).toFixed(2)+"万"):$("#final_pay").text("无")}},a=new carloan(k),b=a.options,a.getpackage(),$('input[name="btn-apply"]').click(function(){var a=carloan.common.format(b.applyposturl,b.csid,b.csspell,b.carid,b.agentid,100*b.payrate,b.loanmonths,b.cityid);window.location.href=a+"&ref=sq3"})}function n(){var n,o,p,a=$(".dkfa_box table"),f=($(".dkfa_box"),$("#city_list"),$(".city_layer"),$(".tc_loging")),g=$("#emptydata"),h=$("#hasshowall"),i=!1,j=a.html(),l=function(){var b=[];a.find('input[name="selpacks"]:checked').each(function(){b.push(this.value)}),$('input[name="packids"]').val(b.join(","))};k.carlist_init_callback=function(a,b){var f,c=a.options,d=[],e=$("#cars");for(e.find("option").each(function(){var f=b["t"+this.value];if(f){if(!(f.referprice>0))return d.push($(this)),void 0;$(this).attr("title",f.goname+" "+(c.csname?c.csname+" ":"")+f.name).attr("carname",f.name)}}),f=0;f<d.length;f++)d[f].remove();e.val()>0?(i=e.find("option:selected"),i.text(i.attr("title"))):(i=e.find("option[carname]:first"),i.length&&(e.val(i[0].value),p.options.carid=i[0].value,p.options.referprice=b["t"+i[0].value].referprice)),e.bind("change",function(){i&&i.text(i.attr("carname"));var a=$(this).val();a>0&&(i=e.find("option:selected"),i.text(i.attr("title")),p.options.carid=a,p.options.referprice=b["t"+a].referprice,p.loadunique())})},k.after_load_callback=function(b,c){var i,k,m,n,o,p,d=b.options,e=c&&c.Total>0;if($(".map_link em").text(e?c.Total:"0"),!e)return f.hide(),g.show(),$('input[name="packids"]').val(""),void 0;for(g.hide(),i=c.Packages,k={},m=0;m<c.Companies.length;m++)k[c.Companies[m].Id]=c.Companies[m];for(n=[],n.push(j),m=0;m<i.length;m++)o=i[m],p=carloan.common.format(d.loandetailurl,d.csid,d.csspell,d.carid,o.Id,100*d.payrate,d.loanmonths,d.cityid),n.push(carloan.common.format("<tr"+(3>m?"":' style="display:none;"')+">"+'<th scope="row"><input type="'+(d.single_select===!0?"radio":"checkbox")+'" value="{0}" name="selpacks" {6}></th>'+'<td><p class="tit"><a href="'+p+'" target="_blank">{3}</a></p><p class="txt"><a href="'+p+'" target="_blank">{1}</a></p></td><td><p class="lixi_yuegong"><span class="lixi">{4}</span>总成本</p></td>'+'<td><p class="lixi_yuegong"><span class="yuegong">{5}元</span>月供</p></td>'+"</tr>",o.Id,o.Name,o.CompanyId,k[o.CompanyId]?k[o.CompanyId].Name:"",0==o.TotalInterest?"0元":(1*o.TotalInterest/1e4).toFixed(2)+"万元",o.MonthlyPayment.toFixed(0),""));a.html(a.html()+n.join("")),d.agentid>0?a.find('th input[value="'+d.agentid+'"]').attr("checked",!0):d.single_select===!0?a.find('input[name="selpacks"]:first').attr("checked",!0):a.find('input[name="selpacks"]:lt(3)').attr("checked",!0),c.Total<=3?($("#btn-show,#btn-hide").hide(),h.show()):($("#btn-show,#btn-hide").show(),h.hide()),a.find('input[name="selpacks"]').click(function(){l()}),l()},k.before_load_callback=function(b){var c=b.options;$("#price-firstpay").text((c.referprice*c.payrate).toFixed(2)),$("#price-total").text(c.referprice),a.empty(),f.show()},k.load_complete_callback=function(){f.hide()},$("#btn-show").click(function(){$(this).hide(),$("#btn-hide").show(),a.find("tr").show()}),$("#btn-hide").click(function(){$(this).hide(),$("#btn-show").show();var b=a.find("tr");b.length>3&&a.find("tr:gt(2)").hide()}),$('#form_chedai input[name="name"],#form_chedai input[name="age"],#form_chedai input[name="mobile"]').blur(function(){this.value=""==this.value?this.defaultValue:this.value}).focus(function(){this.value=this.value==this.defaultValue?"":this.value}),"undefined"!=typeof $.validator&&$.validator.addMethod&&($.validator.addMethod("chinese",function(a){return/^[\u4e00-\u9fa5]+$/.test(a)}),$.validator.addMethod("mobile",function(a,b){var c=a.length,d=/^1[3|4|5|8][0-9]\d{4,8}$/;return this.optional(b)||11==c&&d.test(a)},"请正确输入11位手机号码！"),jQuery.validator.addMethod("defaultInvalid",function(a,b){return!(b.value==b.defaultValue)}),$("#form_chedai").validate({debug:!0,onkeyup:!1,ignore:".ignore",errorElement:"em",errorContainer:$(".tishi"),errorPlacement:function(a,b){a.appendTo(b.closest("li,.val-field").find(".ts_txt"))},rules:{cities:{required:!0,number:!0,min:1},period:{required:!0,number:!0},cars:{required:!0,number:!0,min:1},age:{required:!0,defaultInvalid:!0,number:!0,range:[18,60]},name:{required:!0,defaultInvalid:!0,rangelength:[2,8],chinese:!0},mobile:{required:!0,maxlength:11,number:!0,mobile:!0},packids:{required:!0}},messages:{cities:{required:"请选择城市",min:"请选择城市"},period:{required:"请选择时间！",number:"请选择时间！"},cars:{required:"请选择车型",min:"请选择车型"},age:{required:"请填写年龄！",defaultInvalid:"请填写年龄！",number:"请填写年龄！",range:"对不起，您的年龄尚不具备申请车贷资质！"},name:{required:"请填写您的姓名！",defaultInvalid:"请填写您的姓名！",rangelength:"请填写2~8个汉字的正确姓名！",chinese:"请填写2~8个汉字的正确姓名！"},mobile:{required:"请输入手机号码！",maxlength:"请正确输入11位手机号码！",defaultInvalid:"请输入手机号码！",number:"请正确输入11位手机号码！"},packids:{required:"您至少要选择一种金融套餐！"}}})),n=$('#form_chedai input[name="submit"]'),o=function(a){$("body").css({cursor:"wait"});var a={CityId:$("#cities").val(),CarModelId:$("#cars").val(),BuyCarTime:$("#period").val(),Name:$('#form_chedai input[name="name"]').val(),Gender:$('#form_chedai input[name="gender"]:checked').val(),Age:$('#form_chedai input[name="age"]').val(),Mobile:$('#form_chedai input[name="mobile"]').val(),PackageIds:$('#form_chedai input[name="packids"]').val(),Ref:chedai_config.ref};p.submitapply(a,{success:function(a){var b,c;n.removeAttr("disabled"),$("body").css({cursor:"default"}),1==a||a.IsSuccess?k.apply_success_url&&a.ApplicationId>0&&(b=carloan.common.format(k.apply_success_url,a.ApplicationId),window.location.href=b):(c="保存失败！",carloan.errors["error"+a.ErrorCode]&&(c=carloan.errors["error"+a.ErrorCode].message),alert(c))},error:function(){alert("暂时无法提交申请，请稍候再试！"),n.removeAttr("disabled"),$("body").css({cursor:"default"})}})},$("#form_chedai").submit(function(a){return a.preventDefault(),$("#cars").removeAttr("disabled"),$("#form_chedai").valid()?(n.attr("disabled",!0),o(!1),!1):!1}),$("body").ajaxStart(function(){$(this).css({cursor:"wait"})}).ajaxStop(function(){$(this).css({cursor:"default"})}),p=new carloan(k),p.init(),$('input[name="cities"]').val(p.options.cityid),$("#payrate").val(p.options.payrate),$("#payrate").bind("change",function(){p.options.payrate=$(this).val(),p.loadunique()}),$("#loanmonths").val(p.options.loanmonths),$("#loanmonths").bind("change",function(){p.options.loanmonths=$(this).val(),p.loadunique()}),$("#sorttab a").click(function(a){a.preventDefault(),e&&e.removeClass("nor_px_curr").addClass("nor_px"),e=$(this).addClass("nor_px_curr").removeClass("nor_px"),p.options.orderfield=$(this).attr("fieldname"),p.loadunique()}),e=$("#sorttab a.nor_px_curr")}var c=!1,d=!1,e=!1,f=!1,g=!1,h=!1,i=$("#city_list"),j=$(".city_layer"),k="undefined"!=typeof chedai_config?chedai_config:{};if(k.provinces_init_callback=function(a,b){var e,g,c=a.options,d=$("#div_provinces").empty();for(e=0;e<b.length;e++)g=$("<p></p>").append($('<a href="#"></a>').attr("pid",b[e].ID).attr("title",b[e].Name).text(b[e].Name.substring(0,5))).appendTo(d),c.stateid==b[e].ID&&(f&&f.removeClass("act"),f=g.find("a").addClass("act"),$("#div_cities").empty().append($("<h6></h6>").text(f.attr("title"))),a.getcities());d.find("a").click(function(b){b.preventDefault(),f&&f.removeClass("act"),f=$(this).addClass("act"),$("#div_cities").empty().append($("<h6></h6>").text(f.attr("title"))),a.options.stateid=$(this).attr("pid"),a.getcities(a.options.stateid)}),i.find(".xiala").click(function(){var a="none"==j.css("display");a?j.show():j.hide()})},k.cities_init_callback=function(a,b){var i,j,d=a.options,e=$("#div_cities"),f=a.options.stateid;for(i=0;i<b.length;i++)j=$("<p></p>").append($('<a href="#"></a>').attr("pid",b[i].ID).attr("title",b[i].Name).text(b[i].Name.substring(0,5))).appendTo(e),a.options.municipals["s"+f]&&j.hide(),d.cityid==b[i].ID&&(g&&g.removeClass("curr"),g=j.find("a").addClass("curr"),$(".city_input span").text(g.attr("title").substr(0,5)));e.find("a").click(function(b){b.preventDefault(),g&&g.removeClass("curr"),g=$(this).parent().addClass("curr"),$(".city_layer").hide(),$(".city_input span").text($(this).attr("title").substr(0,5)),a.options.cityid=$(this).attr("pid"),$('input[name="cities"]').val(d.cityid),h&&("undefined"!=typeof chedai_config&&"apply"==chedai_config.pagetype?a.loadunique():a.load())}),a.options.municipals["s"+f]&&e.find("a:eq(0)").click(),h=!0},i.mouseenter(function(){j.show()}).mouseleave(function(){j.hide()}),$(document).click(function(a){a.stopPropagation(),a.target!=j[0]&&0===j.has(a.target).length&&a.target!=i.find(".xiala")[0]&&j.hide()}),"undefined"!=typeof chedai_config)switch(chedai_config.pagetype){case"serial":l();break;case"detail":m();break;case"apply":n()}});